# ドメインモデル

エンティティの id が変化してはいけない。

エンティティやバリューオブジェクトは「どうやって識別するか」という問題の一つの解法でしかない。

エンティティ、
バリューオブジェクト、
ドメインサービス、
ドメインイベント、
の 4 つは実装のパターン。

ドメインモデルは「データをどうやって持つか」よりも「どうやって使うか」を考える。
「便利なモデル」「役に立つモデル」でないといけない。

ドメインモデルやユビキタス言語は「コミュニケーションを助ける」ためにある。

まずはドメイン用語を書き出していくところから始める。

ドメインの洗い出し

1. 要素とそれらの関係性（has, is）
2. さらに詳しい要素の発見（曖昧さの排除）
3. 要素の属性（プロパティ）
4. 要素の操作（メソッド）

[ドメインイベントによるイベント駆動の実装](https://zenn.dev/fuuuuumin65/articles/2c96e8f0b29c01)

エンティティは一種の Builder と考えられる。

エンティティには restruct(data)を持たせて、データソースから取り出したデータを復旧できるようにするといい。factoryMethod だ。

ドメインモデルやユースケースを顧客との共通言語にする。
そのためにも、業務で実際に使う言葉を使って作る。

ドメインモデルとメンタルモデルは違う。
メンタルモデルは単にユーザーの捉え方を分析したものだけど、ドメインモデルは役に立つものでなければならない。役に立たない構造は削ぎ落とす。
対象をどう捉えているかをモデリングするのではない。メンタルモデルを下地にして、製品として扱うべき構造だけを抽出する。
オブジェクト指向はドメインモデルをもとに行われるべき。

メンタルモデルとしては細かく分かれている項目でも、検索も強調して表示もしないただのテキストなら、ドメインモデルとしては全部「備考」でいいこともある。

ユースケースが違ってもコンテキストの内側ならモデルは同じ。
例えば管理者の画面と一般利用者の画面はユースケースが違うけど、モデルは同じ。一部隠されることはあるけど。

ドメインモデルとデータモデルは違う。
ただ、データモデルをドメインモデルに近づけた方が理解しやすい。
逆に、データモデルに合わせてドメインモデルを歪めるべきではない。まず最初に概念としてのドメインモデルがある。

違うものを同じものとして扱ってはならない。
例えば、システム的なアカウント申請の「反映希望日（登録作業日）」とユーザーから見たアカウントの「利用開始日」や「利用終了日（最終利用日）」は同じ日になることもあるが、違う概念なのでドメインを分けて考えるべき。仕様によっては日付がズレることもある。

データベースとしては、複数のドメインにまたがるデータをまとめて一つのテーブルにすることもある。
できれば分けたほうがいいけど、既存のデータベースがあって変える手間がかかりすぎることもある。
