# Repository

データの保存を責務とする。

Data Access Object の一種。

Repository の本質は Aggregate の方。
データアクセスの単位を制限して、Aggregate の単位でしか保存しない。
自由すぎる変更を避ける。

DDD ではドメイン層にインタフェースを置いて、実装を DI する。

データの取得を持たせることがあっても、それは保存のための予備動作。
いろんな取得パターンを作るときは、Repository に持たずに Query Service を作った方がいい。

Repository と Aggregate の層があると、ActiveRecord の Model はデータベースアクセスに専念できる。
複数の Model を一つの Aggregate としてアクセスの単位を固定できる。一定のアクセス方法以外でその Model を変更しない、という制約になる。

送信みたいなタスクをリポジトリとして定義するよりはコマンドとして定義した方がいい。
リポジトリはあくまでも読み書きのためのもの。書き込みだけとか読み取りだけみたいな用途には合わない。

状態管理のためのRepositoryと一覧や検索のためのQueryは分ける。
Repositoryは状態の保管と破棄が主題。get/store/discardがあれば十分。全件取得くらいは持ってもいい。
一覧を得るためのクエリは同じ型を使いつつ分けるといい。なんならドメインよりもアプリケーション層。件数を制限することもある。
