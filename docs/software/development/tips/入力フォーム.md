# フォームの実装

状態管理はフォームコントロールに任せて、submit した情報を外で受け取るか、そのまま API に投げて redux のようなライブラリで受け取る。

フォームは一つのコンポーネントにして、Dispatch まで任せてしまったほうがいい。
submit した時に何らかの処理が必要なら、dispatch 経由でイベントを拾う。

編集の時は defaultValues を渡して、新規の時は何も渡さずに内部で defaultValues を構築する。

フォーム単位で制御コンポーネントはめんどくさい。
フォームコントロールの中身は制御コンポーネントでもいいけど、フォームとしては非制御コンポーネントのようにする。
状態管理をフォームコントロールに任せる。

React の場合、react-hook-form などを使えば、非制御コンポーネントでも外から簡単に値を変更できる。

変更するたびに自動送信するような画面の場合、フォームというよりは、フォームコントロール一つ一つがそれ一つを持ったフォームのように考えられる。

こちらの実装例では、`<form>`ごと切り出して、`<Form />`みたいに取り込んでる。
https://github.com/vercel/virtual-event-starter-kit

`input[type=number]`は数字以外の入力自体を受け付けないので、操作する側にはわかりづらいこともある。
`input[type=text]`でとりあえず入力させて、「半角数字以外は入力できません」というようにエラーメッセージを出すのも選択肢として考えた方がいい。
react-hook-form などを使うと、valid でないなら submit できないし、string でもうまく扱ってくれる。
https://zenn.dev/funteractive/articles/component-input-number

form の入力を変更したときに、他の入力をいじる操作は極力避けた方がいい。
やっていいのはバリデーションでどうしても必要な絞り込みくらい。

HTML 上でフォームの値は number のところでも string で扱っておいて、JS 側で必要に応じてキャストした方がいい。
数字の入力が一時的に空文字になることもあるし。null でも扱えるけど、string が自然。

[これだけは押さえよう！住所フォームの作り方 - ケンオールブログ](https://blog.kenall.jp/entry/address-form-best-practice)

編集しないフォームは label なしの placeholder だけでもいい。
新規入力しかないので、placeholder で何が入るかわかれば入力できる。
逆に、編集するフォームは開いた時点で placeholder が隠れているので label が必要。

フォームコントロールが必ず空で始まるなら、ラベルなしでプレースホルダーのみでもいい。プレースホルダーは必ず表示される。
編集があると値の入った部分にはプレースホルダーが表示されない。ラベルもプレースホルダーもなしでフォームコントロールを区別できるのでなければ、ラベルをつけた方がいい。

React や Vue でチェックボックスを使うなら、選択された id の配列で扱うよりは selected プロパティを持った Object の配列で扱った方がいい。

入力フォームは表示も考慮してデータを持たないといけない。
保存するデータとはまた違うことが多いので、変換を前提に作った方がいい。

フォームをEnterで送信するには、formタグでコントロールを囲んで、type=submitのボタンを置く。

人力で確認する画面ではシステムの制限を緩める。例えば、本来は入力されていないといけない項目でも、人間が良しとするならそのまま進めるとか。ただ、システム的に必須の項目、処理で使うような項目などはシステム側で制限するべき。
