認証サービスとしてAuth0やFirebaseを使うのが簡単。

Keycloak はシングルサインオンなどの認証機能を作るライブラリ。

ログイン必須のアプリは使いづらい。せめて一瞬で登録できるようにする。

既存のアカウントがある場合はそちらに誘導したい。「ログイン」以前に「アカウントを持っているか」を挟んだ方がいいのか？

認証を省略して、いきなり使えるサービスも増えている。
これは無名のユーザーを作っておいて、後からプロフィールやログイン情報を設定してもいいし、しなくてもいい。
メールアドレスを収集しづらいのは欠点だが、サインアップする手間がかからないのでユーザーにとっては入りやすい。

一般的なブラウザではサードパーティクッキーが使えなくなった。ファーストパーティクッキーで認証情報などを持つ場合、localStorageに持つか、iframeに認証サービスのページを埋め込んで認証サービスのファストパーティクッキーから毎回受け取るか。
iframeを使う場合、認証サービス側ではwindow.parentに対してMessaging APIで認証情報などをpostMessageする。iframeで認証ページを埋め込んだ際にメッセージ経由でトークンを受け取れる。

マイクロサービスにおける認証:

- https://www.okta.com/jp/identity-101/what-is-token-based-authentication/
- https://zenn.dev/maronn/articles/aboun-microservices-auth-in-app

JWTで認証する場合、認証サーバーにいちいち問い合わせない限りはトークンが無効化されたかどうかわからない。
JWTの有効期限を短くするのが定石ではある。どこまで短くするかはサービスによる。まぁ、自動ログインでこまめに発行すればいいので、1時間もあれば十分なことが多い。
