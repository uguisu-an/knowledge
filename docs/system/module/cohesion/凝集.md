# Cohesion

関連するものは近くに、関連しないものは遠くに置く。
これが凝集の基本。

日本語では「凝集」の意。
IPA では「強度」とも呼ばれる。

強く凝集している方が良い。

単に「関連」の強い弱いといった方がわかりやすいかも。

やりすぎると構成要素が増えすぎて、全体として複雑になりすぎる。

関連しているものは近づける。
関連していないものは遠ざける。

凝集していると、変更する範囲が小さい。あるいは「決まる」と言うべきか。
一つの変更に対して、一箇所だけ変えるのが理想。

凝集していないと、ごっちゃになってるのを分離しないといけなかったり、逆に何箇所も同じ変更をしないといけなかったりする。

複合的な部分は、各部分を統合する責務だけに集中したい。

全体の処理（特にコントローラーのアクションやサービス）は、以下のようにきれいに分ける。

1. 元となるデータの取得や受信
2. データの変換やチェック
3. 変換したデータの保存や送信

取得の処理の中に変換や保存が混ざってはいけないし、それ以外も同様。
特に、変換の途中で取得したり保存したりする処理がよく見られるが、これは作りが悪い。
きれいに三つに分かれるようにする。

各部をさらに細かい関数に分けたりするのはその後。

オブジェクトの全てのメソッドで全てのプロパティを使わないと、凝集しているとは言えない。

凝集のためには関心や責務を分けないといけない。

処理や要素を切り出すことで、余計なスタイルや処理が切り出されて、それぞれの処理が読みやすくなる。
共通化とは別に、凝集のため、読みやすさのためにモジュールを分離するといい。

情報設計がイマイチだと、内部設計ではどうにもならないこともある。

凝集していないと、まず関連性があるかどうかを切り分けながら読まないといけない。
凝集度の低い設計は、喩えるなら３問のクイズをごちゃ混ぜにして１問にしているようなものだ。

一緒に使うことがないものをわざわざswitchで切り替えて呼び出す必要はない。
昔のphpみたいな。今はRESTで入り口が分かれているので、createとupdateは分ける。

単一責任原則における「変更する理由」というのは、「仕様変更の影響」のこと。
実装は仕様と対応させる。とくにモジュールの実装は一つの仕様にだけ依存するべき。
例えば、通常セールの仕様とサマーセールの仕様の両方に依存してはならない。

凝集、関心の分離。どの情報がどの文脈にあるか。関係ないことは一旦置いといていい。

関係するものは近くに、関係ないものは遠くに置く。

基本的に影響を「狭い範囲に閉じ込める」設計にするべき。高凝集。

高凝集というのは「今回変える範囲を小さくする」のではなく、「今後も変える範囲を小さくできる」こと。
先のことを考えないと高凝集にはならない。また、ドメインを理解しなければ判断できない。

凝集というのは、同じ「歯ブラシ」でも「掃除用」と「歯磨き用」を分けること。
なんでも共通化したらいいわけではない。ドメインが違う。

共通の箇所を変更する際に、種別で分岐のようなことをしないといけないなら、そもそも分けた方がいい。文脈が違う。

歯磨きに使う歯ブラシとトイレ掃除に使う歯ブラシを別の場所に置いておけば、取り間違えてトイレ掃除に使う歯ブラシを口に突っ込まないか心配しなくていい。

## Reference

https://speakerdeck.com/sonatard/coheision-coupling

https://fortee.jp/object-oriented-conference-2020/proposal/a826b6c6-167c-4c5c-bfc7-52bb8bc22ec1
