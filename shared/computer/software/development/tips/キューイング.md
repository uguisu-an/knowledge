# キューイング

処理したいデータが数万件とかになる場合以外でも、ジョブ自体は 100 件とかをまとめて扱うようにした方がいい。
細かくジョブを分けすぎるとジョブの制御に負荷がかかりすぎる。1 件ずつだとダメだった。

あとはキューの中で並行処理しないように制御したりするとその制御にも負荷がかかる。
できるだけシンプルにする。

並行処理したくないものはタスクスケジュールと併用して、いったんデータベースに保存したものを 1 本のプロセスで一つずつ処理する形にしてもいい。
どっちみち並行処理できないなら遅いので、直列処理で遅くなるのは仕方ない。

一度に何万件も登録するようなレベルでキューを使うべきじゃないかも。

キューで処理を分ける場合、大きなデータが入ってくるなら一旦データベースなどに保存して、それぞれのジョブで必要な分だけ取ってきた方がいい。
ジョブが失敗した際などに改めて実行しやすいし、大きな処理を小さな処理に分割できる。
