ブラウザ向けでも localStorage をうまく使うと、最初以外はオフラインで使えるようにもできる。

https://developer.android.com/topic/architecture/data-layer/offline-first?hl=ja

https://watercelldev.hatenablog.jp/entry/2015/04/26/203552

オフライン対応する場合、データは編集したタイミングで変更内容を送るというよりも最新の状態を同期する。変更された時にオンラインだったら即時同期でいいし、オフラインだったらオンラインになった時に同期する。

オフライン対応するためには、ローカルデータソースを持って、ネットワークデータソースと同期させる必要がある。
ローカルデータソースをネットワークデータソースと同期させる（ネットワークデータソースから最新の情報を受け取って、手元の情報でネットワークデータソースを更新する）にはどうしたらいいか。

オフライン対応で一番簡単なのは、どこかのタイミングで全てのローカルデータを削除して、新しいネットワークデータで置き換える方法。編集なしならこれでいい。

ダーティフラグは、以下の 4 つを把握しておけばデータ同期に使える。

clean: サーバーから受け取ったまま（同期されている、差がない）
add: 新規作成された（クライアントにしかない）
mod: サーバーから受け取ったものに変更を加えた
delete: サーバーから受け取ったものを削除した

add の変更や削除は単にローカルデータごと消せばいい。
あとはデータ同期のタイミングで、add/mod/delete に合わせて API を叩く。

ダーティフラグを管理すれば、データを送信することはできるけど、送信したデータでネットワークデータソースを上書きしていいかどうかはまた別。衝突することもある。

差分同期したいなら、サーバー側でも編集履歴を持って、ある日時より後に add/mod/delete されたデータだけを絞り込めるようにしないといけない。
まぁ、これは単に created_at, updated_at, deleted_at でいい。
基本的に論理削除になるので、差分同期の期限を 1 週間にしておいて 1 週間以上同期してなかったら全体同期にして、1 週間以上前に論理削除されたデータを物理削除するとか工夫するとデータが溜まるばかりではなくなる。
