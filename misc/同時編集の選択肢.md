# 同時編集

同時編集を制御する仕様案

1. 自分が開いてから保存するまでに誰かが先に保存していたら、保存に失敗する（簡単でよくある作り。自分が編集していたデータは破棄される）
   (1) 編集開始した日時を記録しておいて、保存時にデータの更新日時と比べる

2. 自分が開いてから保存するまでに誰かが保存しようとするとその人の保存が失敗する（非推奨：1 で充分。誰かが編集していたデータは破棄される）
   (1) WebSocket などでセッション管理（複雑）
   (2) データベースで編集中の状態を管理（非推奨：簡単だがブラウザを閉じても勝手に抜けないのでロックされたままになる可能性がある）
   (3) データベースで編集中の状態を管理して、ロックされたままになっているのを監視して防ぐ（折衷案：編集を終えても数分はロックされたままになる可能性がある）

3. 自分が開くときに誰かが編集していたら開けない（編集する前に気づけるが、確認もできない）
   (1) WebSocket などでセッション管理（複雑）
   (2) データベースで編集中の状態を管理（非推奨：簡単だがブラウザを閉じても勝手に抜けないのでロックされたままになる可能性がある）
   (3) データベースで編集中の状態を管理して、ロックされたままになっているのを監視して防ぐ（折衷案：編集を終えても数分はロックされたままになる可能性がある）

4. 自分が開くときに誰かが編集していたら読み取り専用で開く（編集する前に気づける）
   (1) WebSocket などでセッション管理（複雑）
   (2) データベースで編集中の状態を管理（非推奨：簡単だがブラウザを閉じても勝手に抜けないのでロックされたままになる可能性がある）
   (3) データベースで編集中の状態を管理して、ロックされたままになっているのを監視して防ぐ（折衷案：編集を終えても数分はロックされたままになる可能性がある）

5. 自分が開くときに誰かが編集していたらその人を追い出す（非推奨：使いづらい）
   (1) WebSocket などでセッション管理（複雑）

6. Google Document のように自動保存して同期する（非常に複雑）

基本方針

基本的には 1 で実装したい。
編集したデータが破棄されるのを避けるなら 3 か 4 だが、誰かが編集している間に編集できないのは変わらないので 1 でいいと思う。

参考資料

https://gcsf.zendesk.com/hc/ja/articles/115006030287
https://codezine.jp/article/detail/6764
