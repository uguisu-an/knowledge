# JWT を使った認証

## JWT の利点

アクセストークンを使った認可に比べると、JWT 自体の検証をローカルで処理でき、認可サーバーとの通信が発生しない。
認可サーバーがあるとボトルネックになりやすいが、 JWT なら気にせずにスケールできる。

## トークンの有効期限

以下にもあるように、JWT 自体の有効期限は短く設定して、期限が切れるたびに SSO サーバーから再発行するといい。

> 結局、JWT の有効期間を長くすれば危険で、短くすれば UX が犠牲になるため、Cookie を使った認証の代わりにするのは難しいことがわかりました。そのため、JWT の典型的な使用方法である、以下のような SSO を使った認証を行う方向に切り替えました。
>
> - ログイン時は SSO サーバと Cookie を使った認証を行う。このときに JWT のトークンを発行する。
> - フロントはログイン後に受け取った JWT を以降のバックエンドとの通信に使用する。
> - JWT が切れた場合は SSO サーバとセッションの経路で再発行する。

https://tech.hicustomer.jp/posts/modern-authentication-in-hosting-spa/

結局、アクセストークンを完全に置き換えるものではないが、 JWT が生きている間は認可サーバーとのやりとりを抑えられる。認可サーバーがボトルネックになりにくい。
アクセストークンのようにリフレッシュトークンで簡単に再発行する仕組みがないので SSO を用意する。Auth0 や Cognite のようなサービスを使うといい。

## クライアント側の保存方法

保存場所は Cookie か LocalStorage か、という議論もあるが、有効期限が短いならどちらでもいい。
Cookie は CSRF に弱く、LocalStorage は XSS やサードパーティ製のパッケージ汚染に弱い。

## その他

...
