# データの復元

データが破損したら、復元したい。

## バックアップ

データは定期的にバックアップを取得・保管するべき。

バックアップの周期をどうするか。

バックアップの保管期限をどうするか。

周期が短く、保管期限が長いほど、維持費が高くなる。

全体を毎日バックアップして、一週間分保管する、というように運用を決める。

データベースのように大きなデータの場合、全体のコピーを少ない頻度で、変更履歴を短い頻度でバックアップして、組み合わせて復元することがある。

## 早急な対応

データの破損が起きたら、変更される前にアクセスを止めて、できるだけ早く復元した方がいい。

変更されると、それらの変更も取り込まないといけなくなる。

バックアップの保存期間が切れて破棄されてしまうのも困る。

## 備考

データの障害が起きたら、すぐにスナップショットの保持期間を長めにした方がいい。
その日からしばらく経っても古いデータが取り出せたら戻しやすい。
そんで、まずは応急処置。障害を起こしているところをさっさと直さないといけない。

障害が起きた位置がわからない時、データベースの復旧は、とにかく古いのを確認する。
次の、次の、と追っていって、障害が起きた後が見つかったら、その前のに戻す。
時間が経ってしまっている場合、その次からのバックアップも追っていって、正常なデータの差分を少しずつ拾って、できるだけ現在の状態に近いデータにする。
